<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club Login</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='home.css') }}">
    <style>
        .container {
            display: flex;
            width: 100%;
            height: 100vh;  /* Set the container height to full viewport height */
        }
        .main-content {
            flex: 3;
            padding: 20px;
            overflow-y: auto;  /* Allow vertical scrolling if content overflows */
        }
        .iframe-container {
            flex: 1;
            display: none;
            padding: 20px;
        }
        .iframe-container iframe {
            border: none;
            overflow-y: auto;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="main-content">
        <main>
            <div class="form1">
                <p>special</p><br>
                <div class="form1" style="background-color:rgb(255,231,0);display: flex;flex-direction: column;align-items: center;">
                    {% if user in ["president", "creater"] %}
                    <button onclick="toggleForm()" style="padding: 10px; cursor: pointer; border: none; border-radius: 5px;">Manage Members</button>
                    <form method="POST" id="memberForm" style="display: flex; flex-direction: column; width: 300px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 10px; background-color: #f9f9f9;">
                        <label for="memname" style="margin: 5px 0;">Name</label>
                        <select id="memname" name="nameSelect" style="margin: 5px 0;" onchange="syncInputWithSelect()">
                            <option value="">Select a member...</option>
                            {% for i in members %}
                            <option value="{{ i.mem_name }}">{{ i.mem_name }}</option>
                            {% endfor %}
                        </select>
                        <input type="text" id="memnameInput" name="name" placeholder="Or enter a new member name" style="margin: 5px 0;" oninput="syncSelectWithInput()"><br>

                        <script>
                            function syncInputWithSelect() {
                                var s = document.getElementById('memname');
                                var i = document.getElementById('memnameInput');
                                i.value = s.value;
                                if (s.value === "") {
                                    i.style.display = "block";
                                } else {
                                    i.style.display = "none";
                                    i.value = s.value;
                                    i.placeholder = s.value;
                                }
                            }

                            function syncSelectWithInput() {
                                var select = document.getElementById('memname');
                                var input = document.getElementById('memnameInput');
                                var found = false;
                                for (var i = 0; i < select.options.length; i++) {
                                    if (select.options[i].value === input.value) {
                                        select.selectedIndex = i;
                                        found = true;
                                        break;
                                    }
                                }
                                if (!found) {
                                    select.selectedIndex = 0;
                                }
                            }
                        </script>
                        <div  style="flex-direction:row">
                            <p style="margin: 5p">Access:</p>
                            <label for="member1" >Presidential</label>
                            <input type="radio" id="member1" name="member" value="president">
                            <label for="member2" >Normal</label>
                            <input type="radio" id="member2" name="member" value="member" >
                        </div>

                        <button type="button" onclick="addAction()" style="padding: 10px; margin-top: 10px; cursor: pointer; border: none; border-radius: 5px;">Add Member</button>
                        <button type="button" onclick="deleteAction()" style="padding: 10px; margin-top: 10px; cursor: pointer; border: none; border-radius: 5px;">Delete Member</button>

                        <script>
                            function toggleForm() {
                                var form = document.getElementById('memberForm');
                                if (form.style.display === "none" || form.style.display === "") {
                                    form.style.display = "flex";
                                } else {
                                    form.style.display = "none";
                                }
                            }

                            function addAction() {
                                var form = document.getElementById('memberForm');
                                var name = form.name.value;
                                var access = form.member.value;

                                if (name === "" || access === "") {
                                    alert("Please fill out both name and access level.");
                                    return;
                                }

                                form.action = '{{ url_for("home.add_mem") }}';
                                form.method = 'POST';

                                console.log("Add member:", name, access);
                                alert("Member added: " + name + " with access level " + access);

                                form.submit();
                                form.reset();
                            }

                            function deleteAction() {
                                var form = document.getElementById('memberForm');
                                var name = form.name.value;

                                if (name === "") {
                                    alert("Please enter the name of the member to delete.");
                                    return;
                                }

                                form.action = '{{ url_for("home.del_mem") }}';
                                form.method = 'POST';

                                console.log("Delete member:", name);
                                alert("Member deleted: " + name);

                                form.submit();
                                form.reset();
                            }
                        </script>
                    </form>
                </div><br>
                <h3>CREATE NEW TICKET:</h3>
                <button type="button" onclick="showTicketDetail('new')" style="padding: 10px; margin-top: 10px; cursor: pointer; border: none; border-radius: 5px;">Create</button>
            </div><br>
            <div style="background-color:rgb(255,231,0);width:500px;height:500px;flex-direction: column;align-items: center;">
                {% endif %}
                <br>

                {% set i = 0 %}
                {% for sec in sections %}
                <section id="sections">
                    <h2>{{ sec }}</h2>
                    <div class="tickets" id="tickets">
                        {% for ticket in tickets[sec] %}
                        <div class="ticket" data-ticket-name="{{ ticket.name }}" onclick="showTicketDetail( '{{ ticket.tname }}' )">
                            <h3>{{ ticket.name }}</h3>
                            <p>{{ ticket.description }}</p>
                            <p style="color:rgba(255,0,0,0.6);">Status: {{ ticket.status }}</p>
                        </div>
                        {% endfor %}
                    </div><br>
                    {% set i = i + 1 %}
                    {% endfor %}
                </section>
            </div>
        </main>
    </div>
    <div class="iframe-container">
        <iframe id="ticket-form-iframe" ></iframe>
    </div>
</div>

<script>
    function showTicketDetail(ticketId) {
        var baseUrl = "{{ url_for('home.render', tname='') }}";
        var newUrl = "/"+ticketId+baseUrl  ;
        var iframeContainer = document.querySelector('.iframe-container');
        var iframe = document.getElementById('ticket-form-iframe');
        if (iframe.src && iframe.style.display === 'block' && iframe.src === newUrl) {
            iframeContainer.style.display = 'none';
        } else {

            iframe.src = newUrl;
            iframeContainer.style.display = 'block';
        }
    }
</script>
</body>
</html>
